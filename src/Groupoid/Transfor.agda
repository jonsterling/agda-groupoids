{-# OPTIONS --without-K #-}

module Groupoid.Transfor where

open import Agda.Primitive
import Groupoid.Base as G
import Groupoid.Exponential.Boot as ╬а
import Setoid as S
open import Type as T
  using (_,_)

infixr 0 _РЄњРѓЂрхЌ_

record _РЄњРѓЂрхЌ_ ..{РёЊРѓђрхњ РёЊРѓђ╦брхњ РёЊРѓђ╦б╩░ РёЊРѓЂрхњ РёЊРѓЂ╦брхњ РёЊРѓЂ╦б╩░}
  {A : G.t РёЊРѓђрхњ РёЊРѓђ╦брхњ РёЊРѓђ╦б╩░}
  {B : G.t РёЊРѓЂрхњ РёЊРѓЂ╦брхњ РёЊРѓЂ╦б╩░}
  (F G : A ╬а.РЄњРѓђрхЌ B)
    : Set (РёЊРѓђрхњ Ріћ (РёЊРѓЂ╦брхњ Ріћ РёЊРѓЂ╦б╩░)) where
  no-eta-equality
  constructor natРѓЂ
  field
    comРѓЂ
      : Рѕђ {a}
      Рєњ S.obj (G.hom╦б B (F ╬а.$Рѓђ a , G ╬а.$Рѓђ a))
open _РЄњРѓЂрхЌ_ public

record _РЄњРѓѓ_ ..{РёЊРѓђрхњ РёЊРѓђ╦брхњ РёЊРѓђ╦б╩░ РёЊРѓЂрхњ РёЊРѓЂ╦брхњ РёЊРѓЂ╦б╩░}
  {A : G.t РёЊРѓђрхњ РёЊРѓђ╦брхњ РёЊРѓђ╦б╩░}
  {B : G.t РёЊРѓЂрхњ РёЊРѓЂ╦брхњ РёЊРѓЂ╦б╩░}
  {F G : A ╬а.РЄњРѓђрхЌ B}
  (╬▒ ╬▓ : F РЄњРѓЂрхЌ G)
    : Set (РёЊРѓђрхњ Ріћ (РёЊРѓЂ╦брхњ Ріћ РёЊРѓЂ╦б╩░)) where
  no-eta-equality
  constructor natРѓѓ
  field
    .comРѓѓ
      : Рѕђ {a}
      Рєњ S.homрхЌ (G.hom╦б B (F ╬а.$Рѓђ a , G ╬а.$Рѓђ a)) (comРѓЂ ╬▒ {a} , comРѓЂ ╬▓ {a})
open _РЄњРѓѓ_ public

_РЄњРѓЂ╦б_ : Рѕђ ..{РёЊРѓђрхњ РёЊРѓђ╦брхњ РёЊРѓђ╦б╩░ РёЊРѓЂрхњ РёЊРѓЂ╦брхњ РёЊРѓЂ╦б╩░}
  Рєњ {A : G.t РёЊРѓђрхњ РёЊРѓђ╦брхњ РёЊРѓђ╦б╩░}
  Рєњ {B : G.t РёЊРѓЂрхњ РёЊРѓЂ╦брхњ РёЊРѓЂ╦б╩░}
  Рєњ (F G : A ╬а.РЄњРѓђрхЌ B)
  Рєњ S.t _ _
S.obj (_РЄњРѓЂ╦б_ F G) =
  F РЄњРѓЂрхЌ G
S.homрхЌ (_РЄњРѓЂ╦б_ F G) =
  ╬╗ {(╬▒ , ╬▓) Рєњ ╬▒ РЄњРѓѓ ╬▓}
comРѓѓ (S.idnрхЌрхљ (_РЄњРѓЂ╦б_ {B = B} F G) _) = ╬╗ {a} Рєњ
  S.idnрхЌрхљ (G.hom╦б B (F ╬а.$Рѓђ a , G ╬а.$Рѓђ a)) _
comРѓѓ (S.cmpрхЌрхљ (_РЄњРѓЂ╦б_ {B = B} F G) (gРЄњРѓѓ , fРЄњРѓѓ)) = ╬╗ {a} Рєњ
  S.cmpрхЌрхљ (G.hom╦б B (F ╬а.$Рѓђ a , G ╬а.$Рѓђ a))
    (comРѓѓ gРЄњРѓѓ {a} , comРѓѓ fРЄњРѓѓ {a})
comРѓѓ (S.invрхЌрхљ (_РЄњРѓЂ╦б_ {B = B} F G) fРЄњРѓѓ) = ╬╗ {a} Рєњ
  S.invрхЌрхљ (G.hom╦б B (F ╬а.$Рѓђ a , G ╬а.$Рѓђ a))
    (comРѓѓ fРЄњРѓѓ {a})

-- FIXME: the following should all be setoid morphisms nowРђд

idn
  : Рѕђ ..{РёЊРѓђрхњ РёЊРѓђ╦брхњ РёЊРѓђ╦б╩░ РёЊРѓЂрхњ РёЊРѓЂ╦брхњ РёЊРѓЂ╦б╩░}
  Рєњ {A : G.t РёЊРѓђрхњ РёЊРѓђ╦брхњ РёЊРѓђ╦б╩░} {B : G.t РёЊРѓЂрхњ РёЊРѓЂ╦брхњ РёЊРѓЂ╦б╩░}
  Рєњ (F : A ╬а.РЄњРѓђрхЌ B)
  Рєњ T.­ЮЪЎ.t T.╬а.РЄњРѓђ (F РЄњРѓЂрхЌ F)
comРѓЂ (idn {B = B} F x) = G.idn╦брхљ B S.╬а.$Рѓђ x

cmp
  : Рѕђ ..{РёЊРѓђрхњ РёЊРѓђ╦брхњ РёЊРѓђ╦б╩░ РёЊРѓЂрхњ РёЊРѓЂ╦брхњ РёЊРѓЂ╦б╩░}
  Рєњ {A : G.t РёЊРѓђрхњ РёЊРѓђ╦брхњ РёЊРѓђ╦б╩░} {B : G.t РёЊРѓЂрхњ РёЊРѓЂ╦брхњ РёЊРѓЂ╦б╩░}
  Рєњ {F G H : A ╬а.РЄњРѓђрхЌ B}
  Рєњ (G РЄњРѓЂрхЌ H) T.Рѕљ.РіЌ (F РЄњРѓЂрхЌ G)
  Рєњ F РЄњРѓЂрхЌ H
comРѓЂ (cmp {B = B} (╬▓ , ╬▒)) = G.cmp╦брхљ B S.╬а.$Рѓђ (comРѓЂ ╬▓ , comРѓЂ ╬▒)

inv
  : Рѕђ ..{РёЊРѓђрхњ РёЊРѓђ╦брхњ РёЊРѓђ╦б╩░ РёЊРѓЂрхњ РёЊРѓЂ╦брхњ РёЊРѓЂ╦б╩░}
  Рєњ {A : G.t РёЊРѓђрхњ РёЊРѓђ╦брхњ РёЊРѓђ╦б╩░} {B : G.t РёЊРѓЂрхњ РёЊРѓЂ╦брхњ РёЊРѓЂ╦б╩░}
  Рєњ {F G : A ╬а.РЄњРѓђрхЌ B}
  Рєњ (F РЄњРѓЂрхЌ G) T.╬а.РЄњРѓђ (G РЄњРѓЂрхЌ F)
comРѓЂ (inv {B = B} ╬▒) = G.inv╦брхљ B S.╬а.$Рѓђ (comРѓЂ ╬▒)

cmp-wРѓђ
  : Рѕђ ..{РёЊРѓђрхњ РёЊРѓђ╦брхњ РёЊРѓђ╦б╩░ РёЊРѓЂрхњ РёЊРѓЂ╦брхњ РёЊРѓЂ╦б╩░ РёЊРѓѓрхњ РёЊРѓѓ╦брхњ РёЊРѓѓ╦б╩░}
  Рєњ {A : G.t РёЊРѓђрхњ РёЊРѓђ╦брхњ РёЊРѓђ╦б╩░} {B : G.t РёЊРѓЂрхњ РёЊРѓЂ╦брхњ РёЊРѓЂ╦б╩░} {C : G.t РёЊРѓѓрхњ РёЊРѓѓ╦брхњ РёЊРѓѓ╦б╩░}
  Рєњ {F G : A ╬а.РЄњРѓђрхЌ B}
  Рєњ (H╬▒ : (B ╬а.РЄњРѓђрхЌ C) T.Рѕљ.РіЌ (F РЄњРѓЂрхЌ G))
  Рєњ (T.Рѕљ.¤ђРѓђ H╬▒ ╬а.РѕўрхЌрхљ F) РЄњРѓЂрхЌ (T.Рѕљ.¤ђРѓђ H╬▒ ╬а.РѕўрхЌрхљ G)
comРѓЂ (cmp-wРѓђ (H , ╬▒)) = H ╬а.$РѓЂ comРѓЂ ╬▒

cmp-wРѓЂ
  : Рѕђ ..{РёЊРѓђрхњ РёЊРѓђ╦брхњ РёЊРѓђ╦б╩░ РёЊРѓЂрхњ РёЊРѓЂ╦брхњ РёЊРѓЂ╦б╩░ РёЊРѓѓрхњ РёЊРѓѓ╦брхњ РёЊРѓѓ╦б╩░}
  Рєњ {A : G.t РёЊРѓђрхњ РёЊРѓђ╦брхњ РёЊРѓђ╦б╩░} {B : G.t РёЊРѓЂрхњ РёЊРѓЂ╦брхњ РёЊРѓЂ╦б╩░} {C : G.t РёЊРѓѓрхњ РёЊРѓѓ╦брхњ РёЊРѓѓ╦б╩░}
  Рєњ {G H : B ╬а.РЄњРѓђрхЌ C}
  Рєњ (╬▓F : (G РЄњРѓЂрхЌ H) T.Рѕљ.РіЌ (A ╬а.РЄњРѓђрхЌ B))
  Рєњ (G ╬а.РѕўрхЌрхљ T.Рѕљ.¤ђРѓЂ ╬▓F) РЄњРѓЂрхЌ (H ╬а.РѕўрхЌрхљ T.Рѕљ.¤ђРѓЂ ╬▓F)
comРѓЂ (cmp-wРѓЂ (╬▓ , F)) = comРѓЂ ╬▓

cmp-hРѓђ
  : Рѕђ ..{РёЊРѓђрхњ РёЊРѓђ╦брхњ РёЊРѓђ╦б╩░ РёЊРѓЂрхњ РёЊРѓЂ╦брхњ РёЊРѓЂ╦б╩░ РёЊРѓѓрхњ РёЊРѓѓ╦брхњ РёЊРѓѓ╦б╩░}
  Рєњ {A : G.t РёЊРѓђрхњ РёЊРѓђ╦брхњ РёЊРѓђ╦б╩░} {B : G.t РёЊРѓЂрхњ РёЊРѓЂ╦брхњ РёЊРѓЂ╦б╩░} {C : G.t РёЊРѓѓрхњ РёЊРѓѓ╦брхњ РёЊРѓѓ╦б╩░}
  Рєњ {F G : A ╬а.РЄњРѓђрхЌ B}
  Рєњ {H K : B ╬а.РЄњРѓђрхЌ C}
  Рєњ (╬▓╬▒ : (H РЄњРѓЂрхЌ K) T.Рѕљ.РіЌ (F РЄњРѓЂрхЌ G))
  Рєњ (H ╬а.РѕўрхЌрхљ F) РЄњРѓЂрхЌ (K ╬а.РѕўрхЌрхљ G)
comРѓЂ (cmp-hРѓђ {C = C} {K = K} (╬▓ , ╬▒)) = G.cmp╦брхљ C S.╬а.$Рѓђ (K ╬а.$РѓЂ comРѓЂ ╬▒ , comРѓЂ ╬▓)

cmp-hРѓЂ
  : Рѕђ ..{РёЊРѓђрхњ РёЊРѓђ╦брхњ РёЊРѓђ╦б╩░ РёЊРѓЂрхњ РёЊРѓЂ╦брхњ РёЊРѓЂ╦б╩░ РёЊРѓѓрхњ РёЊРѓѓ╦брхњ РёЊРѓѓ╦б╩░}
  Рєњ {A : G.t РёЊРѓђрхњ РёЊРѓђ╦брхњ РёЊРѓђ╦б╩░} {B : G.t РёЊРѓЂрхњ РёЊРѓЂ╦брхњ РёЊРѓЂ╦б╩░} {C : G.t РёЊРѓѓрхњ РёЊРѓѓ╦брхњ РёЊРѓѓ╦б╩░}
  Рєњ {F G : A ╬а.РЄњРѓђрхЌ B}
  Рєњ {H K : B ╬а.РЄњРѓђрхЌ C}
  Рєњ (╬▓╬▒ : (H РЄњРѓЂрхЌ K) T.Рѕљ.РіЌ (F РЄњРѓЂрхЌ G))
  Рєњ (H ╬а.РѕўрхЌрхљ F) РЄњРѓЂрхЌ (K ╬а.РѕўрхЌрхљ G)
comРѓЂ (cmp-hРѓЂ {C = C} {H = H} (╬▓ , ╬▒)) = G.cmp╦брхљ C S.╬а.$Рѓђ (comРѓЂ ╬▓ , H ╬а.$РѓЂ comРѓЂ ╬▒)
