{-# OPTIONS --without-K #-}

module Groupoid.Core.Homotopy where

open import Agda.Primitive
import Groupoid.Core.Base as G
import Groupoid.Core.Hom.Boot as ╬а
import Setoid as S
open import Type as T
  using (_,_)

infixr 0 _РЄњРѓЂрхЌ_

record _РЄњРѓЂрхЌ_
  {d} ..{РёЊРѓђрхњ РёЊРѓђ╦брхњ РёЊРѓђ╦б╩░ РёЊРѓЂрхњ РёЊРѓЂ╦брхњ РёЊРѓЂ╦б╩░}
  {A : G.t d РёЊРѓђрхњ РёЊРѓђ╦брхњ РёЊРѓђ╦б╩░}
  {B : G.t d РёЊРѓЂрхњ РёЊРѓЂ╦брхњ РёЊРѓЂ╦б╩░}
  (F G : A ╬а.РЄњРѓђрхЌ B)
    : Set ((РёЊРѓђрхњ Ріћ РёЊРѓђ╦брхњ) Ріћ (РёЊРѓЂ╦брхњ Ріћ РёЊРѓЂ╦б╩░)) where
  no-eta-equality
  field
    comРѓЂ
      : Рѕђ {a}
      Рєњ S.obj (G.hom╦б B (F ╬а.$Рѓђ a , G ╬а.$Рѓђ a))
  field
    .natРѓЂ
      : Рѕђ {a b}
      Рєњ (f : S.obj (G.hom╦б A (a , b)))
      Рєњ S.homрхЌ (G.hom╦б B (F ╬а.$Рѓђ _ , G ╬а.$Рѓђ _))
          ( G.cmp╦б B S.╬а.$Рѓђ (comРѓЂ , F ╬а.$РѓЂ f)
          , G.cmp╦б B S.╬а.$Рѓђ (G ╬а.$РѓЂ f , comРѓЂ)
          )
open _РЄњРѓЂрхЌ_ public

record _РЄњРѓѓ_
  {d} ..{РёЊРѓђрхњ РёЊРѓђ╦брхњ РёЊРѓђ╦б╩░ РёЊРѓЂрхњ РёЊРѓЂ╦брхњ РёЊРѓЂ╦б╩░}
  {A : G.t d РёЊРѓђрхњ РёЊРѓђ╦брхњ РёЊРѓђ╦б╩░}
  {B : G.t d РёЊРѓЂрхњ РёЊРѓЂ╦брхњ РёЊРѓЂ╦б╩░}
  {F G : A ╬а.РЄњРѓђрхЌ B}
  (╬▒ ╬▓ : F РЄњРѓЂрхЌ G)
    : Set (РёЊРѓђрхњ Ріћ (РёЊРѓЂ╦брхњ Ріћ РёЊРѓЂ╦б╩░)) where
  no-eta-equality
  field
    .comРѓѓ
      : Рѕђ {a}
      Рєњ S.homрхЌ (G.hom╦б B (F ╬а.$Рѓђ a , G ╬а.$Рѓђ a)) (comРѓЂ ╬▒ {a} , comРѓЂ ╬▓ {a})
open _РЄњРѓѓ_ public

_РЄњРѓЂ╦б_
  : Рѕђ {d} ..{РёЊРѓђрхњ РёЊРѓђ╦брхњ РёЊРѓђ╦б╩░ РёЊРѓЂрхњ РёЊРѓЂ╦брхњ РёЊРѓЂ╦б╩░}
  Рєњ {A : G.t d РёЊРѓђрхњ РёЊРѓђ╦брхњ РёЊРѓђ╦б╩░}
  Рєњ {B : G.t d РёЊРѓЂрхњ РёЊРѓЂ╦брхњ РёЊРѓЂ╦б╩░}
  Рєњ (F G : A ╬а.РЄњРѓђрхЌ B)
  Рєњ S.t S.Dir.РЅѕ _ _
S.obj (_РЄњРѓЂ╦б_ F G) =
  F РЄњРѓЂрхЌ G
S.homрхЌ (_РЄњРѓЂ╦б_ F G) =
  ╬╗ {(╬▒ , ╬▓) Рєњ ╬▒ РЄњРѓѓ ╬▓}
comРѓѓ (S.idnрхЌ (_РЄњРѓЂ╦б_ {B = B} F G) _) =
  S.idnрхЌ (G.hom╦б B (F ╬а.$Рѓђ _ , G ╬а.$Рѓђ _)) _
comРѓѓ (S.cmpрхЌ (_РЄњРѓЂ╦б_ {B = B} F G) (gРЄњРѓѓ , fРЄњРѓѓ)) =
  S.cmpрхЌ (G.hom╦б B (F ╬а.$Рѓђ _ , G ╬а.$Рѓђ _))
    (comРѓѓ gРЄњРѓѓ , comРѓѓ fРЄњРѓѓ)
comРѓѓ (S.invрхЌ (_РЄњРѓЂ╦б_ {B = B} F G) fРЄњРѓѓ) =
  S.invрхЌ (G.hom╦б B (F ╬а.$Рѓђ _ , G ╬а.$Рѓђ _))
    (comРѓѓ fРЄњРѓѓ)

idnРѓЂ╦б
  : Рѕђ {d} ..{РёЊРѓђрхњ РёЊРѓђ╦брхњ РёЊРѓђ╦б╩░ РёЊРѓЂрхњ РёЊРѓЂ╦брхњ РёЊРѓЂ╦б╩░}
  Рєњ {A : G.t d РёЊРѓђрхњ РёЊРѓђ╦брхњ РёЊРѓђ╦б╩░}
  Рєњ {B : G.t d РёЊРѓЂрхњ РёЊРѓЂ╦брхњ РёЊРѓЂ╦б╩░}
  Рєњ (F : A ╬а.РЄњРѓђрхЌ B)
  Рєњ S.­ЮЪЎ.s S.╬а.РЄњРѓђрхЌ (F РЄњРѓЂ╦б F)
comРѓЂ (S.╬а._$Рѓђ_ (idnРѓЂ╦б {B = B} F) _) =
  G.idn╦б B S.╬а.$Рѓђ _
natРѓЂ (S.╬а._$Рѓђ_ (idnРѓЂ╦б {B = B} F) _) _ =
  S.cmpрхЌ (G.hom╦б B (F ╬а.$Рѓђ _ , F ╬а.$Рѓђ _))
    ( G.idn-rhs B (F ╬а.$РѓЂ _)
    , G.idn-lhs B (F ╬а.$РѓЂ _) )
comРѓѓ (S.╬а._$РѓЂ_ (idnРѓЂ╦б {B = B} F) _) =
  G.idn╦б B S.╬а.$РѓЂ _

cmpРѓЂ╦б
  : Рѕђ {d} ..{РёЊРѓђрхњ РёЊРѓђ╦брхњ РёЊРѓђ╦б╩░ РёЊРѓЂрхњ РёЊРѓЂ╦брхњ РёЊРѓЂ╦б╩░}
  Рєњ {A : G.t d РёЊРѓђрхњ РёЊРѓђ╦брхњ РёЊРѓђ╦б╩░}
  Рєњ {B : G.t d РёЊРѓЂрхњ РёЊРѓЂ╦брхњ РёЊРѓЂ╦б╩░}
  Рєњ {F G H : A ╬а.РЄњРѓђрхЌ B}
  Рєњ ((G РЄњРѓЂ╦б H) S.Рѕљ.РіЌ (F РЄњРѓЂ╦б G)) S.╬а.РЄњРѓђрхЌ (F РЄњРѓЂ╦б H)
comРѓЂ (S.╬а._$Рѓђ_ (cmpРѓЂ╦б {B = B}) (╬▓ , ╬▒)) =
  G.cmp╦б B S.╬а.$Рѓђ (comРѓЂ ╬▓ , comРѓЂ ╬▒)
natРѓЂ (S.╬а._$Рѓђ_ (cmpРѓЂ╦б {B = B}) (╬▓ , ╬▒)) _ =
  S.cmpрхЌ (G.hom╦б B _)
  ( G.cmp-ass B _ _ _
  , S.cmpрхЌ (G.hom╦б B _)
    ( G.cmp╦б B S.╬а.$РѓЂ
      ( natРѓЂ ╬▓ _
      , S.idnрхЌ (G.hom╦б B _) _ )
    , S.cmpрхЌ (G.hom╦б B _)
      ( S.invрхЌ (G.hom╦б B _) (G.cmp-ass B _ _ _)
      , S.cmpрхЌ (G.hom╦б B _)
        ( G.cmp╦б B S.╬а.$РѓЂ
          ( S.idnрхЌ (G.hom╦б B _) _
          , natРѓЂ ╬▒ _ )
        , G.cmp-ass B _ _ _ ))))
comРѓѓ (S.╬а._$РѓЂ_ (cmpРѓЂ╦б {B = B}) (╬▓ , ╬▒)) =
  G.cmp╦б B S.╬а.$РѓЂ (comРѓѓ ╬▓ , comРѓѓ ╬▒)

invРѓЂ╦б
  : Рѕђ ..{РёЊРѓђрхњ РёЊРѓђ╦брхњ РёЊРѓђ╦б╩░ РёЊРѓЂрхњ РёЊРѓЂ╦брхњ РёЊРѓЂ╦б╩░}
  Рєњ {A : G.t S.Dir.РЅѕ РёЊРѓђрхњ РёЊРѓђ╦брхњ РёЊРѓђ╦б╩░}
  Рєњ {B : G.t S.Dir.РЅѕ РёЊРѓЂрхњ РёЊРѓЂ╦брхњ РёЊРѓЂ╦б╩░}
  Рєњ {F G : A ╬а.РЄњРѓђрхЌ B}
  Рєњ (F РЄњРѓЂ╦б G) S.╬а.РЄњРѓђрхЌ (G РЄњРѓЂ╦б F)
comРѓЂ (S.╬а._$Рѓђ_ (invРѓЂ╦б {B = B}) ╬▒) =
  G.inv╦б B S.╬а.$Рѓђ (comРѓЂ ╬▒)
comРѓѓ (S.╬а._$РѓЂ_ (invРѓЂ╦б {B = B}) ╬▒) =
  G.inv╦б B S.╬а.$РѓЂ (comРѓѓ ╬▒)
natРѓЂ (S.╬а._$Рѓђ_ (invРѓЂ╦б {A = A}{B = B}) ╬▒) _ =
  S.cmpрхЌ (G.hom╦б B _)
    ( S.cmpрхЌ (G.hom╦б B _)
      ( S.cmpрхЌ (G.hom╦б B _)
        ( S.cmpрхЌ (G.hom╦б B _)
          ( S.cmpрхЌ (G.hom╦б B _)
            ( G.cmp╦б B S.╬а.$РѓЂ
              ( S.cmpрхЌ (G.hom╦б B _)
                ( S.cmpрхЌ (G.hom╦б B _)
                  ( S.cmpрхЌ (G.hom╦б B _)
                    ( G.idn-lhs B _
                    , G.cmp╦б B S.╬а.$РѓЂ
                      ( G.inv-lhs B _
                      , S.idnрхЌ (G.hom╦б B _) _ ) )
                  , S.invрхЌ (G.hom╦б B _) (G.cmp-ass B _ _ _) )
                , G.cmp╦б B S.╬а.$РѓЂ
                  ( S.idnрхЌ (G.hom╦б B _) _
                  , S.invрхЌ (G.hom╦б B _) (natРѓЂ ╬▒ _) ))
              , S.idnрхЌ (G.hom╦б B _) _ )
            , S.invрхЌ (G.hom╦б B _) (G.cmp-ass B _ _ _) )
          , G.cmp╦б B S.╬а.$РѓЂ
            ( S.idnрхЌ (G.hom╦б B _) _
            , S.invрхЌ (G.hom╦б B _) (G.cmp-ass B _ _ _) ) )
        , G.cmp-ass B _ _ _)
      , G.cmp╦б B S.╬а.$РѓЂ (S.idnрхЌ (G.hom╦б B _) _ , G.inv-rhs B _))
    , G.idn-rhs B _)

record _РЅЁ_
  {d} ..{РёЊРѓђрхњ РёЊРѓђ╦брхњ РёЊРѓђ╦б╩░ РёЊРѓЂрхњ РёЊРѓЂ╦брхњ РёЊРѓЂ╦б╩░}
  {A : G.t d РёЊРѓђрхњ РёЊРѓђ╦брхњ РёЊРѓђ╦б╩░}
  {B : G.t d РёЊРѓЂрхњ РёЊРѓЂ╦брхњ РёЊРѓЂ╦б╩░}
  (F G : A ╬а.РЄњРѓђрхЌ B)
    : Set ((РёЊРѓђрхњ Ріћ РёЊРѓђ╦брхњ) Ріћ (РёЊРѓЂ╦брхњ Ріћ РёЊРѓЂ╦б╩░)) where
  no-eta-equality
  field
    fwd : F РЄњРѓЂрхЌ G
    bwd : G РЄњРѓЂрхЌ F
  field
    .iso-fwd : S.homрхЌ (F РЄњРѓЂ╦б F) (cmpРѓЂ╦б S.╬а.$Рѓђ (bwd , fwd) , idnРѓЂ╦б F S.╬а.$Рѓђ _)
    .iso-bwd : S.homрхЌ (G РЄњРѓЂ╦б G) (cmpРѓЂ╦б S.╬а.$Рѓђ (fwd , bwd) , idnРѓЂ╦б G S.╬а.$Рѓђ _)

-- FIXME: cmp-wРѓђ and cmp-wРѓђ are problematic because of H╬▒/╬▓F dependency

cmpРѓЂрхЌ-wРѓђ
  : Рѕђ {d} ..{РёЊРѓђрхњ РёЊРѓђ╦брхњ РёЊРѓђ╦б╩░ РёЊРѓЂрхњ РёЊРѓЂ╦брхњ РёЊРѓЂ╦б╩░ РёЊРѓѓрхњ РёЊРѓѓ╦брхњ РёЊРѓѓ╦б╩░}
  Рєњ {A : G.t d РёЊРѓђрхњ РёЊРѓђ╦брхњ РёЊРѓђ╦б╩░}
  Рєњ {B : G.t d РёЊРѓЂрхњ РёЊРѓЂ╦брхњ РёЊРѓЂ╦б╩░}
  Рєњ {C : G.t d РёЊРѓѓрхњ РёЊРѓѓ╦брхњ РёЊРѓѓ╦б╩░}
  Рєњ {F G : A ╬а.РЄњРѓђрхЌ B}
  Рєњ (H╬▒ : (B ╬а.РЄњРѓђрхЌ C) T.Рѕљ.РіЌ (F РЄњРѓЂрхЌ G))
  Рєњ (T.Рѕљ.¤ђРѓђ H╬▒ ╬а.РѕўРѓђрхЌ F) РЄњРѓЂрхЌ (T.Рѕљ.¤ђРѓђ H╬▒ ╬а.РѕўРѓђрхЌ G)
comРѓЂ (cmpРѓЂрхЌ-wРѓђ (H , ╬▒)) =
  H ╬а.$РѓЂ comРѓЂ ╬▒
natРѓЂ (cmpРѓЂрхЌ-wРѓђ {C = C} (H , ╬▒)) f =
  S.cmpрхЌ (G.hom╦б C _)
  ( ╬а.cmp H _ _
  , S.cmpрхЌ (G.hom╦б C _)
    ( H ╬а.$Рѓѓ (natРѓЂ ╬▒ f)
    , S.invрхЌ (G.hom╦б C _) (╬а.cmp H _ _)))

cmpРѓЂрхЌ-wРѓЂ
  : Рѕђ {d} ..{РёЊРѓђрхњ РёЊРѓђ╦брхњ РёЊРѓђ╦б╩░ РёЊРѓЂрхњ РёЊРѓЂ╦брхњ РёЊРѓЂ╦б╩░ РёЊРѓѓрхњ РёЊРѓѓ╦брхњ РёЊРѓѓ╦б╩░}
  Рєњ {A : G.t d РёЊРѓђрхњ РёЊРѓђ╦брхњ РёЊРѓђ╦б╩░}
  Рєњ {B : G.t d РёЊРѓЂрхњ РёЊРѓЂ╦брхњ РёЊРѓЂ╦б╩░}
  Рєњ {C : G.t d РёЊРѓѓрхњ РёЊРѓѓ╦брхњ РёЊРѓѓ╦б╩░}
  Рєњ {G H : B ╬а.РЄњРѓђрхЌ C}
  Рєњ (╬▓F : (G РЄњРѓЂрхЌ H) T.Рѕљ.РіЌ (A ╬а.РЄњРѓђрхЌ B))
  Рєњ (G ╬а.РѕўРѓђрхЌ T.Рѕљ.¤ђРѓЂ ╬▓F) РЄњРѓЂрхЌ (H ╬а.РѕўРѓђрхЌ T.Рѕљ.¤ђРѓЂ ╬▓F)
comРѓЂ (cmpРѓЂрхЌ-wРѓЂ (╬▓ , F)) = comРѓЂ ╬▓
natРѓЂ (cmpРѓЂрхЌ-wРѓЂ (╬▓ , F)) = natРѓЂ ╬▓ T.╬а.Рѕў F ╬а.$РѓЂ_

cmpРѓђ╦б-hРѓђ
  : Рѕђ {d} ..{РёЊРѓђрхњ РёЊРѓђ╦брхњ РёЊРѓђ╦б╩░ РёЊРѓЂрхњ РёЊРѓЂ╦брхњ РёЊРѓЂ╦б╩░ РёЊРѓѓрхњ РёЊРѓѓ╦брхњ РёЊРѓѓ╦б╩░}
  Рєњ {A : G.t d РёЊРѓђрхњ РёЊРѓђ╦брхњ РёЊРѓђ╦б╩░}
  Рєњ {B : G.t d РёЊРѓЂрхњ РёЊРѓЂ╦брхњ РёЊРѓЂ╦б╩░}
  Рєњ {C : G.t d РёЊРѓѓрхњ РёЊРѓѓ╦брхњ РёЊРѓѓ╦б╩░}
  Рєњ {F G : A ╬а.РЄњРѓђрхЌ B}
  Рєњ {H K : B ╬а.РЄњРѓђрхЌ C}
  Рєњ ((H РЄњРѓЂ╦б K) S.Рѕљ.РіЌ (F РЄњРѓЂ╦б G)) S.╬а.РЄњРѓђрхЌ ((H ╬а.РѕўРѓђрхЌ F) РЄњРѓЂ╦б (K ╬а.РѕўРѓђрхЌ G))
comРѓЂ (S.╬а._$Рѓђ_ (cmpРѓђ╦б-hРѓђ {C = C} {K = K}) (╬▓ , ╬▒)) =
  G.cmp╦б C S.╬а.$Рѓђ (K ╬а.$РѓЂ comРѓЂ ╬▒ , comРѓЂ ╬▓)
comРѓѓ (S.╬а._$РѓЂ_ (cmpРѓђ╦б-hРѓђ {C = C} {K = K}) (╬▓ , ╬▒)) =
  G.cmp╦б C S.╬а.$РѓЂ (K ╬а.$Рѓѓ comРѓѓ ╬▒ , comРѓѓ ╬▓)
natРѓЂ (S.╬а._$Рѓђ_ (cmpРѓђ╦б-hРѓђ {C = C}{K = K}) (╬▓ , ╬▒)) _ =
  S.cmpрхЌ (G.hom╦б C _)
    ( S.cmpрхЌ (G.hom╦б C _)
      ( S.cmpрхЌ (G.hom╦б C _)
        ( S.cmpрхЌ (G.hom╦б C _)
          ( G.cmp-ass C _ _ _
          , G.cmp╦б C S.╬а.$РѓЂ
            ( S.cmpрхЌ (G.hom╦б C _)
              ( S.cmpрхЌ (G.hom╦б C _)
                ( ╬а.cmp K _ _
                , K ╬а.$Рѓѓ natРѓЂ ╬▒ _ )
              , S.invрхЌ (G.hom╦б C _) (╬а.cmp K _ _) )
            , S.idnрхЌ (G.hom╦б C _) _) )
        , S.invрхЌ (G.hom╦б C _) (G.cmp-ass C _ _ _) )
      , G.cmp╦б C S.╬а.$РѓЂ (S.idnрхЌ (G.hom╦б C _) _ , natРѓЂ ╬▓ _) )
    , G.cmp-ass C _ _ _ )

cmpРѓђ╦б-hРѓЂ
  : Рѕђ {d} ..{РёЊРѓђрхњ РёЊРѓђ╦брхњ РёЊРѓђ╦б╩░ РёЊРѓЂрхњ РёЊРѓЂ╦брхњ РёЊРѓЂ╦б╩░ РёЊРѓѓрхњ РёЊРѓѓ╦брхњ РёЊРѓѓ╦б╩░}
  Рєњ {A : G.t d РёЊРѓђрхњ РёЊРѓђ╦брхњ РёЊРѓђ╦б╩░}
  Рєњ {B : G.t d РёЊРѓЂрхњ РёЊРѓЂ╦брхњ РёЊРѓЂ╦б╩░}
  Рєњ {C : G.t d РёЊРѓѓрхњ РёЊРѓѓ╦брхњ РёЊРѓѓ╦б╩░}
  Рєњ {F G : A ╬а.РЄњРѓђрхЌ B}
  Рєњ {H K : B ╬а.РЄњРѓђрхЌ C}
  Рєњ ((H РЄњРѓЂ╦б K) S.Рѕљ.РіЌ (F РЄњРѓЂ╦б G)) S.╬а.РЄњРѓђрхЌ ((H ╬а.РѕўРѓђрхЌ F) РЄњРѓЂ╦б (K ╬а.РѕўРѓђрхЌ G))
comРѓЂ (S.╬а._$Рѓђ_ (cmpРѓђ╦б-hРѓЂ {C = C}{H = H}) (╬▓ , ╬▒)) =
  G.cmp╦б C S.╬а.$Рѓђ (comРѓЂ ╬▓ , H ╬а.$РѓЂ comРѓЂ ╬▒)
comРѓѓ (S.╬а._$РѓЂ_ (cmpРѓђ╦б-hРѓЂ {C = C}{H = H}) (╬▓ , ╬▒)) =
  G.cmp╦б C S.╬а.$РѓЂ (comРѓѓ ╬▓ , H ╬а.$Рѓѓ comРѓѓ ╬▒)
natРѓЂ (S.╬а._$Рѓђ_ (cmpРѓђ╦б-hРѓЂ {C = C}{H = H}) (╬▓ , ╬▒)) _ =
  S.cmpрхЌ (G.hom╦б C _)
    ( S.cmpрхЌ (G.hom╦б C _)
      ( S.cmpрхЌ (G.hom╦б C _)
        ( S.cmpрхЌ (G.hom╦б C _)
          ( G.cmp-ass C _ _ _
          , G.cmp╦б C S.╬а.$РѓЂ
            ( natРѓЂ ╬▓ _
            , S.idnрхЌ (G.hom╦б C _) _ ) )
        , S.invрхЌ (G.hom╦б C _) (G.cmp-ass C _ _ _) )
      , G.cmp╦б C S.╬а.$РѓЂ
        ( S.idnрхЌ (G.hom╦б C _) _
        , S.cmpрхЌ (G.hom╦б C _)
          ( S.cmpрхЌ (G.hom╦б C _)
            ( ╬а.cmp H _ _
            , H ╬а.$Рѓѓ natРѓЂ ╬▒ _ )
          , S.invрхЌ (G.hom╦б C _) (╬а.cmp H _ _) ) ) )
    , G.cmp-ass C _ _ _ )
