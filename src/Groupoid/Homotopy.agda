{-# OPTIONS --without-K #-}

module Groupoid.Homotopy where

open import Agda.Primitive
import Groupoid.Base as G
import Groupoid.Exponential.Boot as ╬а
import Setoid as S
import Setoid.Reasoning
open import Type as T
  using (_,_)

infixr 0 _РЄњРѓЂрхЌ_

record _РЄњРѓЂрхЌ_
  {d} ..{РёЊРѓђрхњ РёЊРѓђ╦брхњ РёЊРѓђ╦б╩░ РёЊРѓЂрхњ РёЊРѓЂ╦брхњ РёЊРѓЂ╦б╩░}
  {A : G.t d РёЊРѓђрхњ РёЊРѓђ╦брхњ РёЊРѓђ╦б╩░}
  {B : G.t d РёЊРѓЂрхњ РёЊРѓЂ╦брхњ РёЊРѓЂ╦б╩░}
  (F G : A ╬а.РЄњРѓђрхЌ B)
    : Set ((РёЊРѓђрхњ Ріћ РёЊРѓђ╦брхњ) Ріћ (РёЊРѓЂ╦брхњ Ріћ РёЊРѓЂ╦б╩░)) where
  no-eta-equality
  field
    comРѓЂ
      : Рѕђ {a}
      Рєњ S.obj (G.hom╦б B (F ╬а.$Рѓђ a , G ╬а.$Рѓђ a))
  field
    .natРѓЂ
      : Рѕђ {a b}
      Рєњ (f : S.obj (G.hom╦б A (a , b)))
      Рєњ S.homрхЌ (G.hom╦б B (F ╬а.$Рѓђ a , G ╬а.$Рѓђ b))
          ( G.cmp╦брхљ B S.╬а.$Рѓђ (comРѓЂ {b} , F ╬а.$РѓЂ f)
          , G.cmp╦брхљ B S.╬а.$Рѓђ (G ╬а.$РѓЂ f , comРѓЂ {a})
          )
open _РЄњРѓЂрхЌ_ public

record _РЄњРѓѓ_
  {d} ..{РёЊРѓђрхњ РёЊРѓђ╦брхњ РёЊРѓђ╦б╩░ РёЊРѓЂрхњ РёЊРѓЂ╦брхњ РёЊРѓЂ╦б╩░}
  {A : G.t d РёЊРѓђрхњ РёЊРѓђ╦брхњ РёЊРѓђ╦б╩░}
  {B : G.t d РёЊРѓЂрхњ РёЊРѓЂ╦брхњ РёЊРѓЂ╦б╩░}
  {F G : A ╬а.РЄњРѓђрхЌ B}
  (╬▒ ╬▓ : F РЄњРѓЂрхЌ G)
    : Set (РёЊРѓђрхњ Ріћ (РёЊРѓЂ╦брхњ Ріћ РёЊРѓЂ╦б╩░)) where
  no-eta-equality
  field
    .comРѓѓ
      : Рѕђ {a}
      Рєњ S.homрхЌ (G.hom╦б B (F ╬а.$Рѓђ a , G ╬а.$Рѓђ a)) (comРѓЂ ╬▒ {a} , comРѓЂ ╬▓ {a})
open _РЄњРѓѓ_ public

_РЄњРѓЂ╦б_
  : Рѕђ {d} ..{РёЊРѓђрхњ РёЊРѓђ╦брхњ РёЊРѓђ╦б╩░ РёЊРѓЂрхњ РёЊРѓЂ╦брхњ РёЊРѓЂ╦б╩░}
  Рєњ {A : G.t d РёЊРѓђрхњ РёЊРѓђ╦брхњ РёЊРѓђ╦б╩░}
  Рєњ {B : G.t d РёЊРѓЂрхњ РёЊРѓЂ╦брхњ РёЊРѓЂ╦б╩░}
  Рєњ (F G : A ╬а.РЄњРѓђрхЌ B)
  Рєњ S.t S.Dir.РЅѕ _ _
S.obj (_РЄњРѓЂ╦б_ F G) =
  F РЄњРѓЂрхЌ G
S.homрхЌ (_РЄњРѓЂ╦б_ F G) =
  ╬╗ {(╬▒ , ╬▓) Рєњ ╬▒ РЄњРѓѓ ╬▓}
comРѓѓ (S.idnрхЌрхљ (_РЄњРѓЂ╦б_ {B = B} F G) _) = ╬╗ {a} Рєњ
  S.idnрхЌрхљ (G.hom╦б B (F ╬а.$Рѓђ a , G ╬а.$Рѓђ a)) _
comРѓѓ (S.cmpрхЌрхљ (_РЄњРѓЂ╦б_ {B = B} F G) (gРЄњРѓѓ , fРЄњРѓѓ)) = ╬╗ {a} Рєњ
  S.cmpрхЌрхљ (G.hom╦б B (F ╬а.$Рѓђ a , G ╬а.$Рѓђ a))
    (comРѓѓ gРЄњРѓѓ {a} , comРѓѓ fРЄњРѓѓ {a})
comРѓѓ (S.invрхЌрхљ (_РЄњРѓЂ╦б_ {B = B} F G) fРЄњРѓѓ) = ╬╗ {a} Рєњ
  S.invрхЌрхљ (G.hom╦б B (F ╬а.$Рѓђ a , G ╬а.$Рѓђ a))
    (comРѓѓ fРЄњРѓѓ {a})

idn╦брхљ
  : Рѕђ {d} ..{РёЊРѓђрхњ РёЊРѓђ╦брхњ РёЊРѓђ╦б╩░ РёЊРѓЂрхњ РёЊРѓЂ╦брхњ РёЊРѓЂ╦б╩░}
  Рєњ {A : G.t d РёЊРѓђрхњ РёЊРѓђ╦брхњ РёЊРѓђ╦б╩░}
  Рєњ {B : G.t d РёЊРѓЂрхњ РёЊРѓЂ╦брхњ РёЊРѓЂ╦б╩░}
  Рєњ (F : A ╬а.РЄњРѓђрхЌ B)
  Рєњ S.­ЮЪЎ.s S.╬а.РЄњРѓђрхЌ (F РЄњРѓЂ╦б F)
comРѓЂ (S.╬а._$Рѓђ_ (idn╦брхљ {B = B} F) x) =
  G.idn╦брхљ B S.╬а.$Рѓђ x
natРѓЂ (S.╬а._$Рѓђ_ (idn╦брхљ {B = B} F) x) = ╬╗ {a b} f Рєњ
  S.cmpрхЌрхљ (G.hom╦б B (F ╬а.$Рѓђ a , F ╬а.$Рѓђ b))
    ( G.idn-rhs B (F ╬а.$РѓЂ f)
    , G.idn-lhs B (F ╬а.$РѓЂ f) )
comРѓѓ (S.╬а._$РѓЂ_ (idn╦брхљ {B = B} F) x) =
  G.idn╦брхљ B S.╬а.$РѓЂ x

cmp╦брхљ
  : Рѕђ {d} ..{РёЊРѓђрхњ РёЊРѓђ╦брхњ РёЊРѓђ╦б╩░ РёЊРѓЂрхњ РёЊРѓЂ╦брхњ РёЊРѓЂ╦б╩░}
  Рєњ {A : G.t d РёЊРѓђрхњ РёЊРѓђ╦брхњ РёЊРѓђ╦б╩░}
  Рєњ {B : G.t d РёЊРѓЂрхњ РёЊРѓЂ╦брхњ РёЊРѓЂ╦б╩░}
  Рєњ {F G H : A ╬а.РЄњРѓђрхЌ B}
  Рєњ ((G РЄњРѓЂ╦б H) S.Рѕљ.РіЌ (F РЄњРѓЂ╦б G)) S.╬а.РЄњРѓђрхЌ (F РЄњРѓЂ╦б H)
comРѓЂ (S.╬а._$Рѓђ_ (cmp╦брхљ {B = B}) (╬▓ , ╬▒)) =
  G.cmp╦брхљ B S.╬а.$Рѓђ (comРѓЂ ╬▓ , comРѓЂ ╬▒)
natРѓЂ (S.╬а._$Рѓђ_ (cmp╦брхљ {B = B}) (╬▓ , ╬▒)) = ╬╗ f Рєњ
  S.cmpрхЌрхљ (G.hom╦б B _)
  ( G.cmp-ass B _ _ _
  , S.cmpрхЌрхљ (G.hom╦б B _)
    ( G.cmp╦брхљ B S.╬а.$РѓЂ (natРѓЂ ╬▓ _ , S.idnрхЌрхљ (G.hom╦б B _) _)
    , S.cmpрхЌрхљ (G.hom╦б B _)
      ( S.invрхЌрхљ (G.hom╦б B _) (G.cmp-ass B _ _ _)
      , S.cmpрхЌрхљ (G.hom╦б B _)
        ( G.cmp╦брхљ B S.╬а.$РѓЂ (S.idnрхЌрхљ (G.hom╦б B _) _ , natРѓЂ ╬▒ _)
        , G.cmp-ass B _ _ _ ))))
comРѓѓ (S.╬а._$РѓЂ_ (cmp╦брхљ {B = B}) (╬▓ , ╬▒)) =
  G.cmp╦брхљ B S.╬а.$РѓЂ (comРѓѓ ╬▓ , comРѓѓ ╬▒)

inv╦брхљ
  : Рѕђ ..{РёЊРѓђрхњ РёЊРѓђ╦брхњ РёЊРѓђ╦б╩░ РёЊРѓЂрхњ РёЊРѓЂ╦брхњ РёЊРѓЂ╦б╩░}
  Рєњ {A : G.t S.Dir.РЅѕ РёЊРѓђрхњ РёЊРѓђ╦брхњ РёЊРѓђ╦б╩░}
  Рєњ {B : G.t S.Dir.РЅѕ РёЊРѓЂрхњ РёЊРѓЂ╦брхњ РёЊРѓЂ╦б╩░}
  Рєњ {F G : A ╬а.РЄњРѓђрхЌ B}
  Рєњ (F РЄњРѓЂ╦б G) S.╬а.РЄњРѓђрхЌ (G РЄњРѓЂ╦б F)
comРѓЂ (S.╬а._$Рѓђ_ (inv╦брхљ {B = B}) ╬▒) =
  G.inv╦брхљ B S.╬а.$Рѓђ (comРѓЂ ╬▒)
comРѓѓ (S.╬а._$РѓЂ_ (inv╦брхљ {B = B}) ╬▒) =
  G.inv╦брхљ B S.╬а.$РѓЂ (comРѓѓ ╬▒)
natРѓЂ (S.╬а._$Рѓђ_ (inv╦брхљ {A = A}{B = B}{F}{G}) ╬▒) = ╬╗ {a b} f Рєњ
  let module SРѓђ = Setoid.Reasoning (G.hom╦б B _) in
      SРѓђ.proof

  G.cmp╦брхљ B S.╬а.$Рѓђ (G.inv╦брхљ B S.╬а.$Рѓђ comРѓЂ ╬▒ , G ╬а.$РѓЂ _)

      SРѓђ.РЅѕРЪе G.idn-rhs B _ РЪЕ

  G.cmp╦брхљ B S.╬а.$Рѓђ
    ( G.cmp╦брхљ B S.╬а.$Рѓђ (G.inv╦брхљ B S.╬а.$Рѓђ comРѓЂ ╬▒ , G ╬а.$РѓЂ _)
    , G.idn╦брхљ B S.╬а.$Рѓђ _ )

      SРѓђ.РЅѕРЪе G.cmp╦брхљ B S.╬а.$РѓЂ (S.idnрхЌрхљ (G.hom╦б B _) _ , G.inv-rhs B _) РЪЕ

  G.cmp╦брхљ B S.╬а.$Рѓђ
    ( G.cmp╦брхљ B S.╬а.$Рѓђ (G.inv╦брхљ B S.╬а.$Рѓђ comРѓЂ ╬▒ , G ╬а.$РѓЂ _)
    , G.cmp╦брхљ B S.╬а.$Рѓђ (comРѓЂ ╬▒ , G.inv╦брхљ B S.╬а.$Рѓђ comРѓЂ ╬▒) )

      SРѓђ.РЅѕРЪе G.cmp-ass B _ _ _ РЪЕ

  G.cmp╦брхљ B S.╬а.$Рѓђ
    ( G.inv╦брхљ B S.╬а.$Рѓђ comРѓЂ ╬▒
    , G.cmp╦брхљ B S.╬а.$Рѓђ (G ╬а.$РѓЂ _ , G.cmp╦брхљ B S.╬а.$Рѓђ (comРѓЂ ╬▒ , G.inv╦брхљ B S.╬а.$Рѓђ comРѓЂ ╬▒)) )

      SРѓђ.РЅѕРЪе G.cmp╦брхљ B S.╬а.$РѓЂ (S.idnрхЌрхљ (G.hom╦б B _) _ , S.invрхЌрхљ (G.hom╦б B _) (G.cmp-ass B _ _ _)) РЪЕ

  G.cmp╦брхљ B S.╬а.$Рѓђ
    ( G.inv╦брхљ B S.╬а.$Рѓђ comРѓЂ ╬▒
    , G.cmp╦брхљ B S.╬а.$Рѓђ (G.cmp╦брхљ B S.╬а.$Рѓђ (G ╬а.$РѓЂ _ , comРѓЂ ╬▒) , G.inv╦брхљ B S.╬а.$Рѓђ comРѓЂ ╬▒) )

      SРѓђ.РЅѕРЪе S.invрхЌрхљ (G.hom╦б B _) (G.cmp-ass B _ _ _) РЪЕ

  G.cmp╦брхљ B S.╬а.$Рѓђ
    ( G.cmp╦брхљ B S.╬а.$Рѓђ (G.inv╦брхљ B S.╬а.$Рѓђ comРѓЂ ╬▒ , G.cmp╦брхљ B S.╬а.$Рѓђ (G ╬а.$РѓЂ _ , comРѓЂ ╬▒))
    , G.inv╦брхљ B S.╬а.$Рѓђ comРѓЂ ╬▒ )

      SРѓђ.РЅѕРЪе G.cmp╦брхљ B S.╬а.$РѓЂ
              (let module SРѓЂ = Setoid.Reasoning (G.hom╦б B _) in
        SРѓЂ.proof

    G.cmp╦брхљ B S.╬а.$Рѓђ (G.inv╦брхљ B S.╬а.$Рѓђ comРѓЂ ╬▒ , G.cmp╦брхљ B S.╬а.$Рѓђ (G ╬а.$РѓЂ f , comРѓЂ ╬▒))

        SРѓЂ.РЅѕРЪе G.cmp╦брхљ B S.╬а.$РѓЂ (S.idnрхЌрхљ (G.hom╦б B _) _ , S.invрхЌрхљ (G.hom╦б B _) (natРѓЂ ╬▒ _)) РЪЕ

    G.cmp╦брхљ B S.╬а.$Рѓђ (G.inv╦брхљ B S.╬а.$Рѓђ comРѓЂ ╬▒ , G.cmp╦брхљ B S.╬а.$Рѓђ (comРѓЂ ╬▒ , F ╬а.$РѓЂ _))

        SРѓЂ.РЅѕРЪе S.invрхЌрхљ (G.hom╦б B _) (G.cmp-ass B _ _ _) РЪЕ

    G.cmp╦брхљ B S.╬а.$Рѓђ (G.cmp╦брхљ B S.╬а.$Рѓђ (G.inv╦брхљ B S.╬а.$Рѓђ comРѓЂ ╬▒ , comРѓЂ ╬▒) , F ╬а.$РѓЂ _)

        SРѓЂ.РЅѕРЪе G.cmp╦брхљ B S.╬а.$РѓЂ (G.inv-lhs B _ , S.idnрхЌрхљ (G.hom╦б B _) _) РЪЕ

    G.cmp╦брхљ B S.╬а.$Рѓђ (G.idn╦брхљ B S.╬а.$Рѓђ _ , F ╬а.$РѓЂ _)

        SРѓЂ.РЅѕРЪе G.idn-lhs B _ РЪЕ

    F ╬а.$РѓЂ f

        SРѓЂ.Рѕј
              , S.idnрхЌрхљ (G.hom╦б B _) _) РЪЕ

  G.cmp╦брхљ B S.╬а.$Рѓђ (F ╬а.$РѓЂ _ , G.inv╦брхљ B S.╬а.$Рѓђ comРѓЂ ╬▒)

      SРѓђ.РЅѕРЪе S.idnрхЌрхљ (G.hom╦б B _) _ РЪЕ

  G.cmp╦брхљ B S.╬а.$Рѓђ (F ╬а.$РѓЂ _ , comРѓЂ (inv╦брхљ S.╬а.$Рѓђ ╬▒))

      SРѓђ.Рѕј

-- FIXME: cmp-wРѓђ and cmp-wРѓђ are problematic because of H╬▒/╬▓F dependency

cmp-wРѓђ
  : Рѕђ {d} ..{РёЊРѓђрхњ РёЊРѓђ╦брхњ РёЊРѓђ╦б╩░ РёЊРѓЂрхњ РёЊРѓЂ╦брхњ РёЊРѓЂ╦б╩░ РёЊРѓѓрхњ РёЊРѓѓ╦брхњ РёЊРѓѓ╦б╩░}
  Рєњ {A : G.t d РёЊРѓђрхњ РёЊРѓђ╦брхњ РёЊРѓђ╦б╩░}
  Рєњ {B : G.t d РёЊРѓЂрхњ РёЊРѓЂ╦брхњ РёЊРѓЂ╦б╩░}
  Рєњ {C : G.t d РёЊРѓѓрхњ РёЊРѓѓ╦брхњ РёЊРѓѓ╦б╩░}
  Рєњ {F G : A ╬а.РЄњРѓђрхЌ B}
  Рєњ (H╬▒ : (B ╬а.РЄњРѓђрхЌ C) T.Рѕљ.РіЌ (F РЄњРѓЂрхЌ G))
  Рєњ (T.Рѕљ.¤ђРѓђ H╬▒ ╬а.РѕўрхЌрхљ F) РЄњРѓЂрхЌ (T.Рѕљ.¤ђРѓђ H╬▒ ╬а.РѕўрхЌрхљ G)
comРѓЂ (cmp-wРѓђ (H , ╬▒)) =
  H ╬а.$РѓЂ comРѓЂ ╬▒
natРѓЂ (cmp-wРѓђ {C = C} (H , ╬▒)) = ╬╗ {a}{b} f Рєњ
  S.cmpрхЌрхљ (G.hom╦б C _)
  ( ╬а.cmp H _ _
  , S.cmpрхЌрхљ (G.hom╦б C _)
    ( H ╬а.$Рѓѓ (natРѓЂ ╬▒ f)
    , S.invрхЌрхљ (G.hom╦б C _) (╬а.cmp H _ _)))

cmp-wРѓЂ
  : Рѕђ {d} ..{РёЊРѓђрхњ РёЊРѓђ╦брхњ РёЊРѓђ╦б╩░ РёЊРѓЂрхњ РёЊРѓЂ╦брхњ РёЊРѓЂ╦б╩░ РёЊРѓѓрхњ РёЊРѓѓ╦брхњ РёЊРѓѓ╦б╩░}
  Рєњ {A : G.t d РёЊРѓђрхњ РёЊРѓђ╦брхњ РёЊРѓђ╦б╩░}
  Рєњ {B : G.t d РёЊРѓЂрхњ РёЊРѓЂ╦брхњ РёЊРѓЂ╦б╩░}
  Рєњ {C : G.t d РёЊРѓѓрхњ РёЊРѓѓ╦брхњ РёЊРѓѓ╦б╩░}
  Рєњ {G H : B ╬а.РЄњРѓђрхЌ C}
  Рєњ (╬▓F : (G РЄњРѓЂрхЌ H) T.Рѕљ.РіЌ (A ╬а.РЄњРѓђрхЌ B))
  Рєњ (G ╬а.РѕўрхЌрхљ T.Рѕљ.¤ђРѓЂ ╬▓F) РЄњРѓЂрхЌ (H ╬а.РѕўрхЌрхљ T.Рѕљ.¤ђРѓЂ ╬▓F)
comРѓЂ (cmp-wРѓЂ (╬▓ , F)) =
  comРѓЂ ╬▓
natРѓЂ (cmp-wРѓЂ (╬▓ , F)) =
  natРѓЂ ╬▓ T.╬а.Рѕў F ╬а.$РѓЂ_

cmp╦брхљ-hРѓђ
  : Рѕђ {d} ..{РёЊРѓђрхњ РёЊРѓђ╦брхњ РёЊРѓђ╦б╩░ РёЊРѓЂрхњ РёЊРѓЂ╦брхњ РёЊРѓЂ╦б╩░ РёЊРѓѓрхњ РёЊРѓѓ╦брхњ РёЊРѓѓ╦б╩░}
  Рєњ {A : G.t d РёЊРѓђрхњ РёЊРѓђ╦брхњ РёЊРѓђ╦б╩░}
  Рєњ {B : G.t d РёЊРѓЂрхњ РёЊРѓЂ╦брхњ РёЊРѓЂ╦б╩░}
  Рєњ {C : G.t d РёЊРѓѓрхњ РёЊРѓѓ╦брхњ РёЊРѓѓ╦б╩░}
  Рєњ {F G : A ╬а.РЄњРѓђрхЌ B}
  Рєњ {H K : B ╬а.РЄњРѓђрхЌ C}
  Рєњ ((H РЄњРѓЂ╦б K) S.Рѕљ.РіЌ (F РЄњРѓЂ╦б G)) S.╬а.РЄњРѓђрхЌ ((H ╬а.РѕўрхЌрхљ F) РЄњРѓЂ╦б (K ╬а.РѕўрхЌрхљ G))
comРѓЂ (S.╬а._$Рѓђ_ (cmp╦брхљ-hРѓђ {C = C} {K = K}) (╬▓ , ╬▒)) =
  G.cmp╦брхљ C S.╬а.$Рѓђ (K ╬а.$РѓЂ comРѓЂ ╬▒ , comРѓЂ ╬▓)
comРѓѓ (S.╬а._$РѓЂ_ (cmp╦брхљ-hРѓђ {C = C} {K = K}) (╬▓ , ╬▒)) =
  G.cmp╦брхљ C S.╬а.$РѓЂ (K ╬а.$Рѓѓ comРѓѓ ╬▒ , comРѓѓ ╬▓)
natРѓЂ (S.╬а._$Рѓђ_ (cmp╦брхљ-hРѓђ {B = B}{C}{F}{G}{H}{K}) (╬▓ , ╬▒)) = ╬╗ {a}{b} f Рєњ
  let module SРѓђ = Setoid.Reasoning (G.hom╦б C _) in
      SРѓђ.proof

  G.cmp╦брхљ C S.╬а.$Рѓђ (comРѓЂ (cmp╦брхљ-hРѓђ S.╬а.$Рѓђ (╬▓ , ╬▒)) , (H ╬а.РѕўрхЌрхљ F) ╬а.$РѓЂ _)

      SРѓђ.РЅѕРЪе S.idnрхЌрхљ (G.hom╦б C _) _ РЪЕ

  G.cmp╦брхљ C S.╬а.$Рѓђ (G.cmp╦брхљ C S.╬а.$Рѓђ (K ╬а.$РѓЂ comРѓЂ ╬▒ , comРѓЂ ╬▓) , H ╬а.$РѓЂ F ╬а.$РѓЂ _)

      SРѓђ.РЅѕРЪе G.cmp-ass C _ _ _ РЪЕ

  G.cmp╦брхљ C S.╬а.$Рѓђ (K ╬а.$РѓЂ comРѓЂ ╬▒ , G.cmp╦брхљ C S.╬а.$Рѓђ (comРѓЂ ╬▓ , H ╬а.$РѓЂ F ╬а.$РѓЂ _))

      SРѓђ.РЅѕРЪе G.cmp╦брхљ C S.╬а.$РѓЂ (S.idnрхЌрхљ (G.hom╦б C _) _ , natРѓЂ ╬▓ (F ╬а.$РѓЂ _)) РЪЕ

  G.cmp╦брхљ C S.╬а.$Рѓђ (K ╬а.$РѓЂ comРѓЂ ╬▒ , G.cmp╦брхљ C S.╬а.$Рѓђ (K ╬а.$РѓЂ F ╬а.$РѓЂ _ , comРѓЂ ╬▓))

      SРѓђ.РЅѕРЪе S.invрхЌрхљ (G.hom╦б C _) (G.cmp-ass C _ _ _) РЪЕ

  G.cmp╦брхљ C S.╬а.$Рѓђ (G.cmp╦брхљ C S.╬а.$Рѓђ (K ╬а.$РѓЂ comРѓЂ ╬▒ , K ╬а.$РѓЂ F ╬а.$РѓЂ f) , comРѓЂ ╬▓)

      SРѓђ.РЅѕРЪе G.cmp╦брхљ C S.╬а.$РѓЂ
         ( S.invрхЌрхљ (G.hom╦б C _) (╬а.cmp K (comРѓЂ ╬▒) (F ╬а.$РѓЂ _))
         , S.idnрхЌрхљ (G.hom╦б C _) _) РЪЕ

  G.cmp╦брхљ C S.╬а.$Рѓђ (K ╬а.$РѓЂ G.cmp╦брхљ B S.╬а.$Рѓђ (comРѓЂ ╬▒ , F ╬а.$РѓЂ _) , comРѓЂ ╬▓)

      SРѓђ.РЅѕРЪе G.cmp╦брхљ C S.╬а.$РѓЂ
            ( S.cmpрхЌрхљ (G.hom╦б C _) (╬а.cmp K (G ╬а.$РѓЂ _) (comРѓЂ ╬▒) , K ╬а.$Рѓѓ natРѓЂ ╬▒ _)
            , S.idnрхЌрхљ (G.hom╦б C _) _
            ) РЪЕ

  G.cmp╦брхљ C S.╬а.$Рѓђ (G.cmp╦брхљ C S.╬а.$Рѓђ (K ╬а.$РѓЂ G ╬а.$РѓЂ _ , K ╬а.$РѓЂ comРѓЂ ╬▒) , comРѓЂ ╬▓)

      SРѓђ.РЅѕРЪе G.cmp-ass C _ _ _ РЪЕ

  G.cmp╦брхљ C S.╬а.$Рѓђ (K ╬а.$РѓЂ G ╬а.$РѓЂ _ , G.cmp╦брхљ C S.╬а.$Рѓђ (K ╬а.$РѓЂ comРѓЂ ╬▒ , comРѓЂ ╬▓))

      SРѓђ.РЅѕРЪе S.idnрхЌрхљ (G.hom╦б C _) _ РЪЕ

  G.cmp╦брхљ C S.╬а.$Рѓђ ((K ╬а.РѕўрхЌрхљ G) ╬а.$РѓЂ _ , comРѓЂ (cmp╦брхљ-hРѓђ S.╬а.$Рѓђ (╬▓ , ╬▒)))

      SРѓђ.Рѕј

cmp╦брхљ-hРѓЂ
  : Рѕђ {d} ..{РёЊРѓђрхњ РёЊРѓђ╦брхњ РёЊРѓђ╦б╩░ РёЊРѓЂрхњ РёЊРѓЂ╦брхњ РёЊРѓЂ╦б╩░ РёЊРѓѓрхњ РёЊРѓѓ╦брхњ РёЊРѓѓ╦б╩░}
  Рєњ {A : G.t d РёЊРѓђрхњ РёЊРѓђ╦брхњ РёЊРѓђ╦б╩░}
  Рєњ {B : G.t d РёЊРѓЂрхњ РёЊРѓЂ╦брхњ РёЊРѓЂ╦б╩░}
  Рєњ {C : G.t d РёЊРѓѓрхњ РёЊРѓѓ╦брхњ РёЊРѓѓ╦б╩░}
  Рєњ {F G : A ╬а.РЄњРѓђрхЌ B}
  Рєњ {H K : B ╬а.РЄњРѓђрхЌ C}
  Рєњ ((H РЄњРѓЂ╦б K) S.Рѕљ.РіЌ (F РЄњРѓЂ╦б G)) S.╬а.РЄњРѓђрхЌ ((H ╬а.РѕўрхЌрхљ F) РЄњРѓЂ╦б (K ╬а.РѕўрхЌрхљ G))
comРѓЂ (S.╬а._$Рѓђ_ (cmp╦брхљ-hРѓЂ {C = C} {H = H}) (╬▓ , ╬▒)) =
  G.cmp╦брхљ C S.╬а.$Рѓђ (comРѓЂ ╬▓ , H ╬а.$РѓЂ comРѓЂ ╬▒)
comРѓѓ (S.╬а._$РѓЂ_ (cmp╦брхљ-hРѓЂ {C = C} {H = H}) (╬▓ , ╬▒)) =
  G.cmp╦брхљ C S.╬а.$РѓЂ (comРѓѓ ╬▓ , H ╬а.$Рѓѓ comРѓѓ ╬▒)
natРѓЂ (S.╬а._$Рѓђ_ (cmp╦брхљ-hРѓЂ {B = B}{C}{F}{G}{H}{K}) (╬▓ , ╬▒)) = ╬╗ {a}{b} f Рєњ
  let module SРѓђ = Setoid.Reasoning (G.hom╦б C _) in
      SРѓђ.proof

  G.cmp╦брхљ C S.╬а.$Рѓђ (comРѓЂ (cmp╦брхљ-hРѓЂ S.╬а.$Рѓђ (╬▓ , ╬▒)) , (H ╬а.РѕўрхЌрхљ F) ╬а.$РѓЂ _)

      SРѓђ.РЅѕРЪе S.idnрхЌрхљ (G.hom╦б C _) _ РЪЕ

  G.cmp╦брхљ C S.╬а.$Рѓђ (G.cmp╦брхљ C S.╬а.$Рѓђ (comРѓЂ ╬▓ , H ╬а.$РѓЂ comРѓЂ ╬▒) , H ╬а.$РѓЂ F ╬а.$РѓЂ _)

      SРѓђ.РЅѕРЪе G.cmp-ass C _ _ _ РЪЕ

  G.cmp╦брхљ C S.╬а.$Рѓђ (comРѓЂ ╬▓ , G.cmp╦брхљ C S.╬а.$Рѓђ (H ╬а.$РѓЂ comРѓЂ ╬▒ , H ╬а.$РѓЂ F ╬а.$РѓЂ _))

      SРѓђ.РЅѕРЪе G.cmp╦брхљ C S.╬а.$РѓЂ (S.idnрхЌрхљ (G.hom╦б C _) _
       , (let module SРѓЂ = Setoid.Reasoning (G.hom╦б C _) in
         SРѓЂ.proof

    G.cmp╦брхљ C S.╬а.$Рѓђ (H ╬а.$РѓЂ comРѓЂ ╬▒ , H ╬а.$РѓЂ F ╬а.$РѓЂ f)

         SРѓЂ.РЅѕРЪе S.invрхЌрхљ (G.hom╦б C _) (╬а.cmp H _ _) РЪЕ

    H ╬а.$РѓЂ G.cmp╦брхљ B S.╬а.$Рѓђ (comРѓЂ ╬▒ , F ╬а.$РѓЂ _)

         SРѓЂ.РЅѕРЪе H ╬а.$Рѓѓ natРѓЂ ╬▒ _ РЪЕ

    H ╬а.$РѓЂ G.cmp╦брхљ B S.╬а.$Рѓђ (G ╬а.$РѓЂ _ , comРѓЂ ╬▒)

         SРѓЂ.РЅѕРЪе ╬а.cmp H _ _ РЪЕ

    G.cmp╦брхљ C S.╬а.$Рѓђ (H ╬а.$РѓЂ G ╬а.$РѓЂ f , H ╬а.$РѓЂ comРѓЂ ╬▒)

         SРѓЂ.Рѕј)) РЪЕ

  G.cmp╦брхљ C S.╬а.$Рѓђ (comРѓЂ ╬▓ , G.cmp╦брхљ C S.╬а.$Рѓђ (H ╬а.$РѓЂ G ╬а.$РѓЂ _ , H ╬а.$РѓЂ comРѓЂ ╬▒))

      SРѓђ.РЅѕРЪе S.invрхЌрхљ (G.hom╦б C _) (G.cmp-ass C _ _ _) РЪЕ

  G.cmp╦брхљ C S.╬а.$Рѓђ (G.cmp╦брхљ C S.╬а.$Рѓђ (comРѓЂ ╬▓ , H ╬а.$РѓЂ G ╬а.$РѓЂ _) , H ╬а.$РѓЂ comРѓЂ ╬▒)

      SРѓђ.РЅѕРЪе G.cmp╦брхљ C S.╬а.$РѓЂ (natРѓЂ ╬▓ _ , S.idnрхЌрхљ (G.hom╦б C _) _) РЪЕ

  G.cmp╦брхљ C S.╬а.$Рѓђ (G.cmp╦брхљ C S.╬а.$Рѓђ (K ╬а.$РѓЂ G ╬а.$РѓЂ _ , comРѓЂ ╬▓) , H ╬а.$РѓЂ comРѓЂ ╬▒)

      SРѓђ.РЅѕРЪе G.cmp-ass C _ _ _ РЪЕ

  G.cmp╦брхљ C S.╬а.$Рѓђ (K ╬а.$РѓЂ G ╬а.$РѓЂ _ , G.cmp╦брхљ C S.╬а.$Рѓђ (comРѓЂ ╬▓ , H ╬а.$РѓЂ comРѓЂ ╬▒))

      SРѓђ.РЅѕРЪе S.idnрхЌрхљ (G.hom╦б C _) _ РЪЕ

  G.cmp╦брхљ C S.╬а.$Рѓђ ((K ╬а.РѕўрхЌрхљ G) ╬а.$РѓЂ _ , comРѓЂ (cmp╦брхљ-hРѓЂ S.╬а.$Рѓђ (╬▓ , ╬▒)))

      SРѓђ.Рѕј
