{-# OPTIONS --without-K #-}

module Ambient.Setoid.Map where

open import Agda.Primitive
import Ambient.Setoid.Base as S
import Ambient.Setoid.Map.Boot as Map
open import Ambient.Setoid.Tensor.Boot as Ten
import Ambient.Setoid.Terminal as ­ЮЪЎ
open import Type as T

infixr 2 _РЄњРѓђ╦б_
infixr 2 _РѕўРѓђ_
infixr 0 _РЄњРѓЂ_
infixr 2 _РѕўРѓЂ_

record _РЄњРѓЂ_
  {d} ..{РёЊРѓђрхњ РёЊРѓђ╩░ РёЊРѓЂрхњ РёЊРѓЂ╩░}
  {A : S.­ЮћіРѓЂ d РёЊРѓђрхњ РёЊРѓђ╩░}
  {B : S.­ЮћіРѓЂ d РёЊРѓЂрхњ РёЊРѓЂ╩░}
  (F G : A Map.РЄњРѓђрхЌ B)
    : Set (РёЊРѓђрхњ Ріћ РёЊРѓЂ╩░) where
  no-eta-equality
  field
    .comРѓЂ
      : Рѕђ {a}
      Рєњ S.cellРѓЂ B (F Map.$Рѓђ a , G Map.$Рѓђ a)
open _РЄњРѓЂ_ public

.comРѓЂрхЌРђ▓
  : Рѕђ {d} ..{РёЊРѓђрхњ РёЊРѓђ╩░ РёЊРѓЂрхњ РёЊРѓЂ╩░}
  Рєњ {A : S.­ЮћіРѓЂ d РёЊРѓђрхњ РёЊРѓђ╩░}
  Рєњ {B : S.­ЮћіРѓЂ d РёЊРѓЂрхњ РёЊРѓЂ╩░}
  Рєњ {F G : A Map.РЄњРѓђрхЌ B}
  Рєњ Рѕђ {a} (╬▒ : F РЄњРѓЂ G)
  Рєњ S.cellРѓЂ B (F Map.$Рѓђ a , G Map.$Рѓђ a)
comРѓЂрхЌРђ▓ ╬▒ = comРѓЂ ╬▒

idnРѓЂрхЌ
  : Рѕђ {d} ..{РёЊРѓђрхњ РёЊРѓђ╩░ РёЊРѓЂрхњ РёЊРѓЂ╩░}
  Рєњ {A : S.­ЮћіРѓЂ d РёЊРѓђрхњ РёЊРѓђ╩░}
  Рєњ {B : S.­ЮћіРѓЂ d РёЊРѓЂрхњ РёЊРѓЂ╩░}
  Рєњ (F : A Map.РЄњРѓђрхЌ B)
  Рєњ ­ЮЪЎРѓђ РЄњРѓђ,Рѓђ (F РЄњРѓЂ F)
comРѓЂ (idnРѓЂрхЌ {B = B} F x) = S.idn B x

cmpРѓЂрхЌ
  : Рѕђ {d} ..{РёЊРѓђрхњ РёЊРѓђ╩░ РёЊРѓЂрхњ РёЊРѓЂ╩░}
  Рєњ {A : S.­ЮћіРѓЂ d РёЊРѓђрхњ РёЊРѓђ╩░}
  Рєњ {B : S.­ЮћіРѓЂ d РёЊРѓЂрхњ РёЊРѓЂ╩░}
  Рєњ {F G H : A Map.РЄњРѓђрхЌ B}
  Рєњ (G РЄњРѓЂ H) ├ЌРѓђ (F РЄњРѓЂ G)
  Рєњ F РЄњРѓЂ H
comРѓЂ (cmpРѓЂрхЌ {B = B} (╬▓ , ╬▒)) =
  S.cmp B (comРѓЂ ╬▓ , comРѓЂ ╬▒)

invРѓЂрхЌ
  : Рѕђ ..{РёЊРѓђрхњ РёЊРѓђ╩░ РёЊРѓЂрхњ РёЊРѓЂ╩░}
  Рєњ {A : S.­ЮћіРѓЂ S.Dir.РЅѕ РёЊРѓђрхњ РёЊРѓђ╩░}
  Рєњ {B : S.­ЮћіРѓЂ S.Dir.РЅѕ РёЊРѓЂрхњ РёЊРѓЂ╩░}
  Рєњ {F G : A Map.РЄњРѓђрхЌ B}
  Рєњ (F РЄњРѓЂ G) РЄњРѓђ,Рѓђ (G РЄњРѓЂ F)
comРѓЂ (invРѓЂрхЌ {B = B} ╬▒) = S.inv B (comРѓЂ ╬▒)

cmpРѓЂрхЌ-wРѓђ
  : Рѕђ {d} ..{РёЊРѓђрхњ РёЊРѓђ╩░ РёЊРѓЂрхњ РёЊРѓЂ╩░ РёЊРѓѓрхњ РёЊРѓѓ╩░ }
  Рєњ {A : S.­ЮћіРѓЂ d РёЊРѓђрхњ РёЊРѓђ╩░}
  Рєњ {B : S.­ЮћіРѓЂ d РёЊРѓЂрхњ РёЊРѓЂ╩░}
  Рєњ {C : S.­ЮћіРѓЂ d РёЊРѓѓрхњ РёЊРѓѓ╩░}
  Рєњ {F G : A Map.РЄњРѓђрхЌ B}
  Рєњ (H╬▒ : (B Map.РЄњРѓђрхЌ C) ├ЌРѓђ (F РЄњРѓЂ G))
  Рєњ (¤ђРЂ░Рѓђ H╬▒ Map.РѕўРѓђрхЌ F) РЄњРѓЂ (¤ђРЂ░Рѓђ H╬▒ Map.РѕўРѓђрхЌ G)
comРѓЂ (cmpРѓЂрхЌ-wРѓђ (H , ╬▒)) = H Map.$РѓЂ comРѓЂ ╬▒

cmpРѓЂрхЌ-wРѓЂ
  : Рѕђ {d} ..{РёЊРѓђрхњ РёЊРѓђ╩░ РёЊРѓЂрхњ РёЊРѓЂ╩░ РёЊРѓѓрхњ РёЊРѓѓ╩░}
  Рєњ {A : S.­ЮћіРѓЂ d РёЊРѓђрхњ РёЊРѓђ╩░}
  Рєњ {B : S.­ЮћіРѓЂ d РёЊРѓЂрхњ РёЊРѓЂ╩░}
  Рєњ {C : S.­ЮћіРѓЂ d РёЊРѓѓрхњ РёЊРѓѓ╩░}
  Рєњ {G H : B Map.РЄњРѓђрхЌ C}
  Рєњ (╬▓F : (G РЄњРѓЂ H) ├ЌРѓђ (A Map.РЄњРѓђрхЌ B))
  Рєњ (G Map.РѕўРѓђрхЌ ¤ђ┬╣Рѓђ ╬▓F) РЄњРѓЂ (H Map.РѕўРѓђрхЌ ¤ђ┬╣Рѓђ ╬▓F)
comРѓЂ (cmpРѓЂрхЌ-wРѓЂ (╬▓ , F)) = comРѓЂ ╬▓

cmpРѓЂрхЌ-hРѓђ
  : Рѕђ {d} ..{РёЊРѓђрхњ РёЊРѓђ╩░ РёЊРѓЂрхњ РёЊРѓЂ╩░ РёЊРѓѓрхњ РёЊРѓѓ╩░}
  Рєњ {A : S.­ЮћіРѓЂ d РёЊРѓђрхњ РёЊРѓђ╩░}
  Рєњ {B : S.­ЮћіРѓЂ d РёЊРѓЂрхњ РёЊРѓЂ╩░}
  Рєњ {C : S.­ЮћіРѓЂ d РёЊРѓѓрхњ РёЊРѓѓ╩░}
  Рєњ {F G : A Map.РЄњРѓђрхЌ B}
  Рєњ {H K : B Map.РЄњРѓђрхЌ C}
  Рєњ (╬▓╬▒ : (H РЄњРѓЂ K) ├ЌРѓђ (F РЄњРѓЂ G))
  Рєњ (H Map.РѕўРѓђрхЌ F) РЄњРѓЂ (K Map.РѕўРѓђрхЌ G)
comРѓЂ (cmpРѓЂрхЌ-hРѓђ {C = C} {K = K} (╬▓ , ╬▒)) =
  S.cmp C (K Map.$РѓЂ comРѓЂ ╬▒ , comРѓЂ ╬▓)

cmpРѓЂрхЌ-hРѓЂ
  : Рѕђ {d} ..{РёЊРѓђрхњ РёЊРѓђ╩░ РёЊРѓЂрхњ РёЊРѓЂ╩░ РёЊРѓѓрхњ РёЊРѓѓ╩░}
  Рєњ {A : S.­ЮћіРѓЂ d РёЊРѓђрхњ РёЊРѓђ╩░}
  Рєњ {B : S.­ЮћіРѓЂ d РёЊРѓЂрхњ РёЊРѓЂ╩░}
  Рєњ {C : S.­ЮћіРѓЂ d РёЊРѓѓрхњ РёЊРѓѓ╩░}
  Рєњ {F G : A Map.РЄњРѓђрхЌ B}
  Рєњ {H K : B Map.РЄњРѓђрхЌ C}
  Рєњ (╬▓╬▒ : (H РЄњРѓЂ K) ├ЌРѓђ (F РЄњРѓЂ G))
  Рєњ (H Map.РѕўРѓђрхЌ F) РЄњРѓЂ (K Map.РѕўРѓђрхЌ G)
comРѓЂ (cmpРѓЂрхЌ-hРѓЂ {C = C} {H = H} (╬▓ , ╬▒)) =
  S.cmp C (comРѓЂ ╬▓ , H Map.$РѓЂ comРѓЂ ╬▒)

_РЄњРѓђ╦б_
  : Рѕђ {d} ..{РёЊРѓђрхњ РёЊРѓђ╩░ РёЊРѓЂрхњ РёЊРѓЂ╩░}
  Рєњ (A : S.­ЮћіРѓЂ d РёЊРѓђрхњ РёЊРѓђ╩░)
  Рєњ (B : S.­ЮћіРѓЂ d РёЊРѓЂрхњ РёЊРѓЂ╩░)
  Рєњ S.­ЮћіРѓЂ d _ _
S.cellРѓђ (A РЄњРѓђ╦б B) =
  A Map.РЄњРѓђрхЌ B
S.cellРѓЂ (A РЄњРѓђ╦б B) =
  ╬╗ {(F , G) Рєњ F РЄњРѓЂ G}
S.idn (A РЄњРѓђ╦б B) =
  idnРѓЂрхЌ _
S.cmp (A РЄњРѓђ╦б B) =
  cmpРѓЂрхЌ
S.inv (_РЄњРѓђ╦б_ {S.Dir.РЅц} A B) =
  _
S.inv (_РЄњРѓђ╦б_ {S.Dir.РЅѕ} A B) =
  invРѓЂрхЌ

idnРѓђ╦б
  : Рѕђ {d} ..{РёЊрхњ РёЊ╩░}
  Рєњ {A : S.­ЮћіРѓЂ d РёЊрхњ РёЊ╩░}
  Рєњ ­ЮЪЎ.s Map.РЄњРѓђрхЌ (A РЄњРѓђ╦б A)
Map._$Рѓђ_ idnРѓђ╦б = Map.idnРѓђрхЌ
Map._$РѓЂ_ idnРѓђ╦б = idnРѓЂрхЌ _

cmpРѓђ╦б
  : Рѕђ {d} ..{РёЊРѓђрхњ РёЊРѓђ╩░ РёЊРѓЂрхњ РёЊРѓЂ╩░ РёЊРѓѓрхњ РёЊРѓѓ╩░}
  Рєњ {A : S.­ЮћіРѓЂ d РёЊРѓђрхњ РёЊРѓђ╩░}
  Рєњ {B : S.­ЮћіРѓЂ d РёЊРѓЂрхњ РёЊРѓЂ╩░}
  Рєњ {C : S.­ЮћіРѓЂ d РёЊРѓѓрхњ РёЊРѓѓ╩░}
  Рєњ (B РЄњРѓђ╦б C) Ten.РіЌ (A РЄњРѓђ╦б B) Map.РЄњРѓђрхЌ (A РЄњРѓђ╦б C)
Map._$Рѓђ_ cmpРѓђ╦б = Map.cmpРѓђрхЌ
Map._$РѓЂ_ cmpРѓђ╦б = cmpРѓЂрхЌ-hРѓЂ

!╦б : Рѕђ {d} ..{РёЊРѓђрхњ РёЊРѓђ╩░ РёЊРѓЂрхњ РёЊРѓЂ╩░}
  Рєњ {A : S.­ЮћіРѓЂ d РёЊРѓђрхњ РёЊРѓђ╩░}
  Рєњ {B : S.­ЮћіРѓЂ d РёЊРѓЂрхњ РёЊРѓЂ╩░}
  Рєњ S.cellРѓђ A Рєњ (B Map.РЄњРѓђрхЌ A)
Map._$Рѓђ_ (!╦б a) = РЄњРѓђ.elmРѓђ a
Map._$РѓЂ_ (!╦б {A = A} _) = РЄњРѓђ.elmРѓђ (S.idn A *)

_РѕўРѓђ_
  : Рѕђ {d} ..{РёЊРѓђрхњ РёЊРѓђ╩░ РёЊРѓЂрхњ РёЊРѓЂ╩░ РёЊРѓѓрхњ РёЊРѓѓ╩░}
  Рєњ {A : S.­ЮћіРѓЂ d РёЊРѓђрхњ РёЊРѓђ╩░}
  Рєњ {B : S.­ЮћіРѓЂ d РёЊРѓЂрхњ РёЊРѓЂ╩░}
  Рєњ {C : S.­ЮћіРѓЂ d РёЊРѓѓрхњ РёЊРѓѓ╩░}
  Рєњ (G : B Map.РЄњРѓђрхЌ C)
  Рєњ (F : A Map.РЄњРѓђрхЌ B)
  Рєњ (A Map.РЄњРѓђрхЌ C)
G РѕўРѓђ F = G Map.РѕўРѓђрхЌ F

._РѕўРѓЂ_
  : Рѕђ {d} ..{РёЊРѓђрхњ РёЊРѓђ╩░ РёЊРѓЂрхњ РёЊРѓЂ╩░ РёЊРѓѓрхњ РёЊРѓѓ╩░}
  Рєњ {A : S.­ЮћіРѓЂ d РёЊРѓђрхњ РёЊРѓђ╩░}
  Рєњ {B : S.­ЮћіРѓЂ d РёЊРѓЂрхњ РёЊРѓЂ╩░}
  Рєњ {C : S.­ЮћіРѓЂ d РёЊРѓѓрхњ РёЊРѓѓ╩░}
  Рєњ {F G : A Map.РЄњРѓђрхЌ B}
  Рєњ {H K : B Map.РЄњРѓђрхЌ C}
  Рєњ (╬▓ : H РЄњРѓЂ K)
  Рєњ (╬▒ : F РЄњРѓЂ G)
  Рєњ (H Map.РѕўРѓђрхЌ F) РЄњРѓЂ (K Map.РѕўРѓђрхЌ G)
╬▓ РѕўРѓЂ ╬▒ = cmpРѓђ╦б Map.$РѓЂ (╬▓ , ╬▒)

open import Ambient.Setoid.Map.Boot public
