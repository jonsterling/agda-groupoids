{-# OPTIONS --without-K #-}

module Ambient.Setoid.Map where

open import Agda.Primitive
import Ambient.Setoid.Base as S
import Ambient.Setoid.Map.Boot as Map
open import Ambient.Setoid.Tensor.Boot as Ten
import Ambient.Setoid.Terminal as ­ЮЪЎ
open import Type as T
  using (_,_)

infixr 2 _РЄњРѓђ╦б_
infixr 2 _РѕўРѓђ_
infixr 0 _РЄњРѓЂ_
infixr 2 _РѕўРѓЂ_

record _РЄњРѓЂ_
  {d} ..{РёЊРѓђрхњ РёЊРѓђ╩░ РёЊРѓЂрхњ РёЊРѓЂ╩░}
  {A : S.t d РёЊРѓђрхњ РёЊРѓђ╩░}
  {B : S.t d РёЊРѓЂрхњ РёЊРѓЂ╩░}
  (F G : A Map.РЄњРѓђрхЌ B)
    : Set (РёЊРѓђрхњ Ріћ РёЊРѓЂ╩░) where
  no-eta-equality
  field
    .comРѓЂ
      : Рѕђ {a}
      Рєњ S.homрхЌ B (F Map.$Рѓђ a , G Map.$Рѓђ a)
open _РЄњРѓЂ_ public

.comРѓЂрхЌРђ▓
  : Рѕђ {d} ..{РёЊРѓђрхњ РёЊРѓђ╩░ РёЊРѓЂрхњ РёЊРѓЂ╩░}
  Рєњ {A : S.t d РёЊРѓђрхњ РёЊРѓђ╩░}
  Рєњ {B : S.t d РёЊРѓЂрхњ РёЊРѓЂ╩░}
  Рєњ {F G : A Map.РЄњРѓђрхЌ B}
  Рєњ Рѕђ {a} (╬▒ : F РЄњРѓЂ G)
  Рєњ S.homрхЌ B (F Map.$Рѓђ a , G Map.$Рѓђ a)
comРѓЂрхЌРђ▓ ╬▒ = comРѓЂ ╬▒

idnРѓЂрхЌ
  : Рѕђ {d} ..{РёЊРѓђрхњ РёЊРѓђ╩░ РёЊРѓЂрхњ РёЊРѓЂ╩░}
  Рєњ {A : S.t d РёЊРѓђрхњ РёЊРѓђ╩░}
  Рєњ {B : S.t d РёЊРѓЂрхњ РёЊРѓЂ╩░}
  Рєњ (F : A Map.РЄњРѓђрхЌ B)
  Рєњ T.­ЮЪЎ.t T.Map.РЄњРѓђ (F РЄњРѓЂ F)
comРѓЂ (idnРѓЂрхЌ {B = B} F x) = S.idnрхЌ B x

cmpРѓЂрхЌ
  : Рѕђ {d} ..{РёЊРѓђрхњ РёЊРѓђ╩░ РёЊРѓЂрхњ РёЊРѓЂ╩░}
  Рєњ {A : S.t d РёЊРѓђрхњ РёЊРѓђ╩░}
  Рєњ {B : S.t d РёЊРѓЂрхњ РёЊРѓЂ╩░}
  Рєњ {F G H : A Map.РЄњРѓђрхЌ B}
  Рєњ (G РЄњРѓЂ H) T.Ten.РіЌ (F РЄњРѓЂ G)
  Рєњ F РЄњРѓЂ H
comРѓЂ (cmpРѓЂрхЌ {B = B} (╬▓ , ╬▒)) =
  S.cmpрхЌ B (comРѓЂ ╬▓ , comРѓЂ ╬▒)

invРѓЂрхЌ
  : Рѕђ ..{РёЊРѓђрхњ РёЊРѓђ╩░ РёЊРѓЂрхњ РёЊРѓЂ╩░}
  Рєњ {A : S.t S.Dir.РЅѕ РёЊРѓђрхњ РёЊРѓђ╩░}
  Рєњ {B : S.t S.Dir.РЅѕ РёЊРѓЂрхњ РёЊРѓЂ╩░}
  Рєњ {F G : A Map.РЄњРѓђрхЌ B}
  Рєњ (F РЄњРѓЂ G) T.Map.РЄњРѓђ (G РЄњРѓЂ F)
comРѓЂ (invРѓЂрхЌ {B = B} ╬▒) = S.invрхЌ B (comРѓЂ ╬▒)

cmpРѓЂрхЌ-wРѓђ
  : Рѕђ {d} ..{РёЊРѓђрхњ РёЊРѓђ╩░ РёЊРѓЂрхњ РёЊРѓЂ╩░ РёЊРѓѓрхњ РёЊРѓѓ╩░ }
  Рєњ {A : S.t d РёЊРѓђрхњ РёЊРѓђ╩░}
  Рєњ {B : S.t d РёЊРѓЂрхњ РёЊРѓЂ╩░}
  Рєњ {C : S.t d РёЊРѓѓрхњ РёЊРѓѓ╩░}
  Рєњ {F G : A Map.РЄњРѓђрхЌ B}
  Рєњ (H╬▒ : (B Map.РЄњРѓђрхЌ C) T.Ten.РіЌ (F РЄњРѓЂ G))
  Рєњ (T.Ten.¤ђРѓђ H╬▒ Map.РѕўРѓђрхЌ F) РЄњРѓЂ (T.Ten.¤ђРѓђ H╬▒ Map.РѕўРѓђрхЌ G)
comРѓЂ (cmpРѓЂрхЌ-wРѓђ (H , ╬▒)) = H Map.$РѓЂ comРѓЂ ╬▒

cmpРѓЂрхЌ-wРѓЂ
  : Рѕђ {d} ..{РёЊРѓђрхњ РёЊРѓђ╩░ РёЊРѓЂрхњ РёЊРѓЂ╩░ РёЊРѓѓрхњ РёЊРѓѓ╩░}
  Рєњ {A : S.t d РёЊРѓђрхњ РёЊРѓђ╩░}
  Рєњ {B : S.t d РёЊРѓЂрхњ РёЊРѓЂ╩░}
  Рєњ {C : S.t d РёЊРѓѓрхњ РёЊРѓѓ╩░}
  Рєњ {G H : B Map.РЄњРѓђрхЌ C}
  Рєњ (╬▓F : (G РЄњРѓЂ H) T.Ten.РіЌ (A Map.РЄњРѓђрхЌ B))
  Рєњ (G Map.РѕўРѓђрхЌ T.Ten.¤ђРѓЂ ╬▓F) РЄњРѓЂ (H Map.РѕўРѓђрхЌ T.Ten.¤ђРѓЂ ╬▓F)
comРѓЂ (cmpРѓЂрхЌ-wРѓЂ (╬▓ , F)) = comРѓЂ ╬▓

cmpРѓЂрхЌ-hРѓђ
  : Рѕђ {d} ..{РёЊРѓђрхњ РёЊРѓђ╩░ РёЊРѓЂрхњ РёЊРѓЂ╩░ РёЊРѓѓрхњ РёЊРѓѓ╩░}
  Рєњ {A : S.t d РёЊРѓђрхњ РёЊРѓђ╩░}
  Рєњ {B : S.t d РёЊРѓЂрхњ РёЊРѓЂ╩░}
  Рєњ {C : S.t d РёЊРѓѓрхњ РёЊРѓѓ╩░}
  Рєњ {F G : A Map.РЄњРѓђрхЌ B}
  Рєњ {H K : B Map.РЄњРѓђрхЌ C}
  Рєњ (╬▓╬▒ : (H РЄњРѓЂ K) T.Ten.РіЌ (F РЄњРѓЂ G))
  Рєњ (H Map.РѕўРѓђрхЌ F) РЄњРѓЂ (K Map.РѕўРѓђрхЌ G)
comРѓЂ (cmpРѓЂрхЌ-hРѓђ {C = C} {K = K} (╬▓ , ╬▒)) =
  S.cmpрхЌ C (K Map.$РѓЂ comРѓЂ ╬▒ , comРѓЂ ╬▓)

cmpРѓЂрхЌ-hРѓЂ
  : Рѕђ {d} ..{РёЊРѓђрхњ РёЊРѓђ╩░ РёЊРѓЂрхњ РёЊРѓЂ╩░ РёЊРѓѓрхњ РёЊРѓѓ╩░}
  Рєњ {A : S.t d РёЊРѓђрхњ РёЊРѓђ╩░}
  Рєњ {B : S.t d РёЊРѓЂрхњ РёЊРѓЂ╩░}
  Рєњ {C : S.t d РёЊРѓѓрхњ РёЊРѓѓ╩░}
  Рєњ {F G : A Map.РЄњРѓђрхЌ B}
  Рєњ {H K : B Map.РЄњРѓђрхЌ C}
  Рєњ (╬▓╬▒ : (H РЄњРѓЂ K) T.Ten.РіЌ (F РЄњРѓЂ G))
  Рєњ (H Map.РѕўРѓђрхЌ F) РЄњРѓЂ (K Map.РѕўРѓђрхЌ G)
comРѓЂ (cmpРѓЂрхЌ-hРѓЂ {C = C} {H = H} (╬▓ , ╬▒)) =
  S.cmpрхЌ C (comРѓЂ ╬▓ , H Map.$РѓЂ comРѓЂ ╬▒)

_РЄњРѓђ╦б_
  : Рѕђ {d} ..{РёЊРѓђрхњ РёЊРѓђ╩░ РёЊРѓЂрхњ РёЊРѓЂ╩░}
  Рєњ (A : S.t d РёЊРѓђрхњ РёЊРѓђ╩░)
  Рєњ (B : S.t d РёЊРѓЂрхњ РёЊРѓЂ╩░)
  Рєњ S.t d _ _
S.obj (A РЄњРѓђ╦б B) =
  A Map.РЄњРѓђрхЌ B
S.homрхЌ (A РЄњРѓђ╦б B) =
  ╬╗ {(F , G) Рєњ F РЄњРѓЂ G}
S.idnрхЌ (A РЄњРѓђ╦б B) =
  idnРѓЂрхЌ _
S.cmpрхЌ (A РЄњРѓђ╦б B) =
  cmpРѓЂрхЌ
S.invрхЌ (_РЄњРѓђ╦б_ {S.Dir.РЅц} A B) =
  _
S.invрхЌ (_РЄњРѓђ╦б_ {S.Dir.РЅѕ} A B) =
  invРѓЂрхЌ

idnРѓђ╦б
  : Рѕђ {d} ..{РёЊрхњ РёЊ╩░}
  Рєњ {A : S.t d РёЊрхњ РёЊ╩░}
  Рєњ ­ЮЪЎ.s Map.РЄњРѓђрхЌ (A РЄњРѓђ╦б A)
Map._$Рѓђ_ idnРѓђ╦б = Map.idnРѓђрхЌ
Map._$РѓЂ_ idnРѓђ╦б = idnРѓЂрхЌ _

cmpРѓђ╦б
  : Рѕђ {d} ..{РёЊРѓђрхњ РёЊРѓђ╩░ РёЊРѓЂрхњ РёЊРѓЂ╩░ РёЊРѓѓрхњ РёЊРѓѓ╩░}
  Рєњ {A : S.t d РёЊРѓђрхњ РёЊРѓђ╩░}
  Рєњ {B : S.t d РёЊРѓЂрхњ РёЊРѓЂ╩░}
  Рєњ {C : S.t d РёЊРѓѓрхњ РёЊРѓѓ╩░}
  Рєњ (B РЄњРѓђ╦б C) Ten.РіЌ (A РЄњРѓђ╦б B) Map.РЄњРѓђрхЌ (A РЄњРѓђ╦б C)
Map._$Рѓђ_ cmpРѓђ╦б = Map.cmpРѓђрхЌ
Map._$РѓЂ_ cmpРѓђ╦б = cmpРѓЂрхЌ-hРѓЂ

!╦б : Рѕђ {d} ..{РёЊРѓђрхњ РёЊРѓђ╩░ РёЊРѓЂрхњ РёЊРѓЂ╩░}
  Рєњ {A : S.t d РёЊРѓђрхњ РёЊРѓђ╩░}
  Рєњ {B : S.t d РёЊРѓЂрхњ РёЊРѓЂ╩░}
  Рєњ S.obj A Рєњ (B Map.РЄњРѓђрхЌ A)
Map._$Рѓђ_ (!╦б a) = T.Map.elm a
Map._$РѓЂ_ (!╦б {A = A} _) = T.Map.elm (S.idnрхЌ A T.­ЮЪЎ.*)

_РѕўРѓђ_
  : Рѕђ {d} ..{РёЊРѓђрхњ РёЊРѓђ╩░ РёЊРѓЂрхњ РёЊРѓЂ╩░ РёЊРѓѓрхњ РёЊРѓѓ╩░}
  Рєњ {A : S.t d РёЊРѓђрхњ РёЊРѓђ╩░}
  Рєњ {B : S.t d РёЊРѓЂрхњ РёЊРѓЂ╩░}
  Рєњ {C : S.t d РёЊРѓѓрхњ РёЊРѓѓ╩░}
  Рєњ (G : B Map.РЄњРѓђрхЌ C)
  Рєњ (F : A Map.РЄњРѓђрхЌ B)
  Рєњ (A Map.РЄњРѓђрхЌ C)
G РѕўРѓђ F = G Map.РѕўРѓђрхЌ F

._РѕўРѓЂ_
  : Рѕђ {d} ..{РёЊРѓђрхњ РёЊРѓђ╩░ РёЊРѓЂрхњ РёЊРѓЂ╩░ РёЊРѓѓрхњ РёЊРѓѓ╩░}
  Рєњ {A : S.t d РёЊРѓђрхњ РёЊРѓђ╩░}
  Рєњ {B : S.t d РёЊРѓЂрхњ РёЊРѓЂ╩░}
  Рєњ {C : S.t d РёЊРѓѓрхњ РёЊРѓѓ╩░}
  Рєњ {F G : A Map.РЄњРѓђрхЌ B}
  Рєњ {H K : B Map.РЄњРѓђрхЌ C}
  Рєњ (╬▓ : H РЄњРѓЂ K)
  Рєњ (╬▒ : F РЄњРѓЂ G)
  Рєњ (H Map.РѕўРѓђрхЌ F) РЄњРѓЂ (K Map.РѕўРѓђрхЌ G)
╬▓ РѕўРѓЂ ╬▒ = cmpРѓђ╦б Map.$РѓЂ (╬▓ , ╬▒)

open import Ambient.Setoid.Map.Boot public
